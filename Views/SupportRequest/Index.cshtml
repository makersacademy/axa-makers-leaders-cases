@

<!DOCTYPE html>
<html>
<head>
    <title>Support Requests</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Support Requests</h1>
    <form id="addRequestForm">
        <input type="text" name="customerName" placeholder="Customer Name" required />
        <input type="text" name="description" placeholder="Description" required />
        <button type="submit">Add Request</button>
    </form>

    <form id="filterRequests">
            <select id="filter">
                <option value="1">All</option>
                <option value="2">Resolved</option>
                <option value="3">Unresolved</option>
            </select>
    </form>

    <ul id="requestList">
        @foreach (var request in Model)
        {
            @{Html.RenderPartial("SupportRequestItem", request)};
        }
    </ul>

    <script>
        $(document).ready(function() {
            $('#addRequestForm').submit(function(e) {
                e.preventDefault();
                $.ajax({
                    url: '/SupportRequest/AddRequest',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function(response) {
                        var newItem = '<li class="request-item" data-id="' + response.id + '">' +
                            '<span>' + response.customerName + ': ' + response.description + '</span>' +
                            '<button class="resolve-button" data-id="' + response.id + '">Resolve</button>' +
                            '</li>';
                        $('#requestList').prepend(newItem);
                        $('#addRequestForm')[0].reset();
                    }
                });
            });

        $('#filter').change(function(e) {   
                e.preventDefault();
                $.ajax({
                    url: '/SupportRequest/FilterRequest',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function(response) {
                        // TODO: render returned HTML into the #requestList element
                    }
                });
            });

            $(document).on('click', '.resolve-button', function() {
                var id = $(this).data('id');
                $.ajax({
                    url: '/SupportRequest/ResolveRequest',
                    type: 'POST',
                    data: { id: id },
                    success: function(response) {
                        if (response.success) {
                            var $item = $('.request-item[data-id="' + response.id + '"]');
                            $item.find('.resolve-button').replaceWith('<span> (Resolved)</span>');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>